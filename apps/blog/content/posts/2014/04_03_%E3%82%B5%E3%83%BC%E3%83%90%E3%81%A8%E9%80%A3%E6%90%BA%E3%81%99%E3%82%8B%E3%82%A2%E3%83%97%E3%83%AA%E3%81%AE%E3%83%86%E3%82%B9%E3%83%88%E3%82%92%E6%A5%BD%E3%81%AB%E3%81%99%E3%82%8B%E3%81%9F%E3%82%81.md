---
title: サーバと連携するアプリのテストを楽にするためにやっていること
date: 2014-04-02T16:32:53.000Z
id: "12921228815721218261"
draft: false
---
できるだけビルドせずにいろいろ変更できると楽だよね、
ということでFacebookのTweaksを[紹介](http://ka2n.hatenablog.com/entry/2014/04/03/Facebook/Tweaks)したのだけどそれに関連する話題。
サーバサイドの開発中に作っているAPIをアプリでとりあえず試したいという時に以下のようなアプローチをとっている。


今のチームではサーバサイドの開発用に通称`ブランチ君`という仕組みがあってフィーチャーブランチ毎にドメインを分けてテスト環境を用意するようにしている
((Jenkinsが監視して、Capistranoがデータベースの作成やデプロイ先を準備して準備し終わった環境の設定値を環境変数等でアプリケーションに渡す感じ. ドメインはRoute53でワイルドカード指定できるのでそれを活用してる))((無事デプロイされたら妹っていうボットが教えてくれたりする。
))。

テスト環境の一覧は
`http://dev.example.com/endpoints.json`にアクセスすると一覧を取得できる様にしてある。((今は1台のサーバに各環境を同居させているので単純にディレクトリを調べてブランチ名一覧を作っている。))

```javascript
[
  {
    "branch": "master",
    "host": "master.dev.example.com"
  },
  {
    "branch": "some/feature_branch",
    "host": "some-feature-branch.dev.example.com"
  }
]
```

アプリではこれを読んで設定画面からホストを選択する。

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/k/ka2nn/20140402/20140402205548.png" alt="f:id:ka2nn:20140402205548p:plain" title="f:id:ka2nn:20140402205548p:plain" style="width: 10em" class="hatena-fotolife" itemprop="image"></span><br />こんな感じ</p>

直接ホストを打ってもらうと結構間違えるのでそれだけでも手間が省ける。
こうしておくとリリース前のテストとかすごく楽。

こういうことを普通にやっている会社は多いと思うけどやっていないなら小規模なプロジェクトでも(でこそ)費用対効果は高いと思うのでおすすめです。

## 追記

とりあえず[https://vagrantcloud.com/:title]のVagrant Shareを使ってテスト環境つくって[https://github.com/facebook/Tweaks:title]使えば手っ取り早い。
