---
title: LinuxからSoftEther VPNサーバ(SSL VPN)へ接続したあとの使い方
date: 2018-05-01T08:13:23.000Z
id: "17391345971640440397"
draft: false
---
接続した後にどうするのかわからなくて苦戦したのでメモ。

環境は

- クライアント側: `SoftEther VPN Version 4.25 Build 9656`, `Linux healthy 4.15.18-1-MANJARO #1 SMP PREEMPT Thu Apr 19 09:05:40 UTC 2018 x86_64 GNU/Linux`
- サーバ側: GithubのSoftEtherVPN_Stableのmaster

目的: 設定済みのSoftEther VPNサーバへvpnazure.net経由でNATを超えて接続する。ゲートウェイにはせずにVPN内のホストにIPアドレス直打ちでアクセスしたい。


SSL VPNで、サーバ側はNATの中にある状態。なんと、vpnazure.netが使える。(SSTP専用かと思いきや)
`vpncmd`でアカウントを設定しておきます。ホスト名に`vpnazure.net`のホスト名を使用する。(素晴らしい)
仮想NIC名は`VPN`で作成。


**VPNへ接続**

SoftEther VPN Clientで接続

	$ vpncmd /client localhost /CMD AccountConnect <アカウント名>
	
IPアドレスを割り当てる。デフォルトゲートウェイには追加せず、/etc/resolv.confも書き換えないようにする。

	# ip link set vpn_vpn down
	# ip link set vpn_vpn up
	# dhcpcd -G -C resolv.conf vpn_vpn
	# ip route add 192.168.100.0/24 via 192.168.30.1 dev vpn_vpn # VPN経由でアクセスしたいネットワークを指定

以上

**VPNから切断**

SoftEther VPN Clientで切断

	$ vpncmd /client localhost /CMD AccountDisconnect <アカウント名>
	
IPアドレスの割り当てを削除

	# ip link set vpn_vpn down
	# ip link set vpn_vpn up
	# dhcpcd -k vpn_vpn
