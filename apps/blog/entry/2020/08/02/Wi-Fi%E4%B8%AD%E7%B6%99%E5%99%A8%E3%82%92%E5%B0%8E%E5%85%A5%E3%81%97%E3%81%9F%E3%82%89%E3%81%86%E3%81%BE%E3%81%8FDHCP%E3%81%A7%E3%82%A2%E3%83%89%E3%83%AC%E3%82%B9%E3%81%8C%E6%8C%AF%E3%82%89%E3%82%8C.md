---
title: Wi-Fi中継器を導入したらうまくDHCPでアドレスが振られない不具合に遭遇したがよくわからないまま解決した
date: 2020-08-02T02:47:46.000Z
id: "26006613608658378"
draft: false
---
作業部屋からAPまでが遠いせいで受信強度が不安定で、速度にも影響が出ていたのでWi-Fi中継器を導入した。



[https://twitter.com/ka2nJa/status/1289062408363716609:embed]


それなりに使えている気がしたのだけど、たまにiPhoneなどでWi-Fiネットワークには接続できているように見えるが、実際はネットワークに繋らない。といいった現象になっているので調べてみた。
iOSの画面上ではDHCPサーバによって割り当てられるはずのIPアドレスがいつまでたっても降ってこない。そのため通信できない状況になっているようだ。

調べてみると以下のような記事をみつけた。


[https://www.buffalo.jp/support/faq/detail/15691.html:embed:cite]


[https://superuser.com/a/472607:embed:cite]


> A client that cannot receive unicast IP datagrams until its protocol
   software has been configured with an IP address SHOULD set the
   BROADCAST bit in the 'flags' field to 1 in any DHCPDISCOVER or
   DHCPREQUEST messages that client sends.  The BROADCAST bit will
   provide a hint to the DHCP server and BOOTP relay agent to broadcast
   any messages to the client on the client's subnet.  A client that can
   receive unicast IP datagrams before its protocol software has been
   configured SHOULD clear the BROADCAST bit to 0.  The BOOTP
   clarifications document discusses the ramifications of the use of the
   BROADCAST bit [21].


[https://tools.ietf.org/html/rfc2131:title]




なるほど(わからん)、rfc2131によると`DHCPOFFER`はユニキャストで送信されることがあるようだ。
中継器はブロードキャストでないとそのパケットを受け取れないので実際のクライアントまでDHCPOFFERを取り次げない。ということかな...?

使っているルーターを調べてみたが、どのオプションにあたるのか全然わからなかった。

[http://www.rtpro.yamaha.co.jp/RT/manual/rt-common/dhcp/dhcp_server_rfc2131_compliant.html:title]


----------

とりあえず、中継器のIPアドレスだけでも固定割当にしとくかー。と設定した所で、問題なく動くようになってしまった。これが問題を解決しているのかわかっていない。が、元々固定割り当てにするつもりだったので本来は遭遇しない問題なんだろう。。。今は気にしない事にする。

